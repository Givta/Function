services:
  - type: web
    name: givta-backend
    env: node
    # This region will be applied on your next deploy. Ensure your Redis instance is also in this region.
    region: Oregon (US West)
    plan: free

    # These commands will be run from the 'rootDir' directory.
    buildCommand: npm install && npm run build
    startCommand: npm start

    # The rootDir is '.' because render.yaml is already inside the 'Backend' directory.
    rootDir: .

    # Non-sensitive environment variables.
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      - key: FIREBASE_PROJECT_ID
        value: givta-94cb8
      - key: ALLOWED_ORIGINS
        value: https://givta.app,https://givta-admin.netlify.app,exp://exp.host
      - key: ENABLE_WHATSAPP_BOT
        value: "true" # or "false"

      # --- Secrets Management ---
      # These 'fromSecret' keys reference secret variables you must create in the Render dashboard
      # under your service's 'Environment' tab.
      - key: JWT_SECRET
        fromSecret: JWT_SECRET # Name of the secret variable in Render
      - key: JWT_REFRESH_SECRET
        fromSecret: JWT_REFRESH_SECRET # Name of the secret variable in Render
      - key: PAYSTACK_SECRET_KEY
        fromSecret: PAYSTACK_SECRET_KEY # Name of the secret variable in Render
      - key: PAYSTACK_PUBLIC_KEY
        fromSecret: PAYSTACK_PUBLIC_KEY # Name of the secret variable in Render

      # Firebase environment variables (set these as secrets in Render)
      - key: FIREBASE_PRIVATE_KEY_ID
        fromSecret: FIREBASE_PRIVATE_KEY_ID
      - key: FIREBASE_PRIVATE_KEY
        fromSecret: FIREBASE_PRIVATE_KEY
      - key: FIREBASE_CLIENT_EMAIL
        fromSecret: FIREBASE_CLIENT_EMAIL
      - key: FIREBASE_CLIENT_ID
        fromSecret: FIREBASE_CLIENT_ID
      - key: FIREBASE_AUTH_URI
        fromSecret: FIREBASE_AUTH_URI
      - key: FIREBASE_TOKEN_URI
        fromSecret: FIREBASE_TOKEN_URI
      - key: FIREBASE_AUTH_PROVIDER_X509_CERT_URL
        fromSecret: FIREBASE_AUTH_PROVIDER_X509_CERT_URL
      - key: FIREBASE_CLIENT_X509_CERT_URL
        fromSecret: FIREBASE_CLIENT_X509_CERT_URL

      # Optional: Redis (only if you have a Redis service)
      # - key: REDIS_URL
      #   fromService:
      #     type: redis
      #     property: connectionString
    healthCheckPath: /api/health
    # Auto-deploy is enabled, so any 'git push' to your main branch will trigger a new deployment.
    autoDeploy: true
